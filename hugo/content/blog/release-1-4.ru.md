+++
title = 'Вышел Kotatogram 1.4!'
date = "2021-04-14T00:48:00+03:00"
description = 'Пора Kotatogram тоже обновиться.'
+++

Очень долгое время Kotatogram был заброшен. Но на самом деле не был, просто у меня не было времени пофиксить баги. Некоторые ещё остались, но так как по большей части всё работает так, как и должно, я отправляю релиз в стабильную ветку.

{{< subheader >}}
## Скачать стабильную 1.4
на основе Telegram Desktop 2.7.1
{{< /subheader >}}

{{< subheader >}}
### Windows
Поддерживает Windows 7 и выше. 
{{< /subheader >}}

{{< button-group class="actions" >}}
    {{< button title="Установщик 32-бит" link= "https://github.com/kotatogram/kotatogram-desktop/releases/download/k1.4/1.4-win32-setup.exe" class="icon solid fa-download primary" >}}
    {{< button title="Портативная 32-бит" link= "https://github.com/kotatogram/kotatogram-desktop/releases/download/k1.4/1.4-win32-portable.zip" class="icon solid fa-download primary" >}}
{{< /button-group >}}

{{< button-group class="actions" >}}
    {{< button title="Установщик 64-бит" link= "https://github.com/kotatogram/kotatogram-desktop/releases/download/k1.4/1.4-win64-setup.exe" class="icon solid fa-download primary" >}}
    {{< button title="Портативная 64-бит" link= "https://github.com/kotatogram/kotatogram-desktop/releases/download/k1.4/1.4-win64-portable.zip" class="icon solid fa-download primary" >}}
{{< /button-group >}}

{{< subheader >}}
### Linux
Поддерживает Ubuntu 16.04 и выше.
{{< /subheader >}}

{{< button-group class="actions" >}}
    {{< button title="AppImage" link= "https://github.com/kotatogram/kotatogram-desktop/releases/download/k1.4/1.4-appimage.tar.xz" class="icon solid fa-download primary" >}}
{{< /button-group >}}

{{< subheader >}}
#### Альтернативные способы
Имейте в виду, что они могут быть обновлены не сразу.
{{< /subheader >}}

{{< button-group class="actions" >}}
    {{< button title="Страница на FlatHub" link= "https://flathub.org/apps/details/io.github.kotatogram" >}}
    {{< button title="Страница на Repology" link= "https://repology.org/project/kotatogram-desktop/versions" >}}
{{< /button-group >}}

{{< subheader >}}
### macOS {#stable-macos}
Поддерживает macOS 10.15 и выше.
{{</ subheader >}}

{{< button-group class="actions" >}}
    {{< button title="Скачать" link= "https://github.com/kotatogram/kotatogram-desktop/releases/download/k1.4/1.4-macos.dmg" class="icon solid fa-download primary" >}}
{{< /button-group >}}

## Изменения

В первую очередь важно сказать, что исходники Telegram Desktop были обновлены до 2.7.1, а это значит, что в Kotatogram теперь есть все актуальные на этот момент функции из него:

* Мультиаккаунт (если вы обновляетесь со стабильной версии)
* Видеозвонки (если вы обновляетесь со стабильной версии)
* Анонимные администраторы
* Комментарии
* Мультипины
* Альбомы для файлов
* Запись голосовых сообщений без постоянного удерживания кнопки
* Голосовые чаты в группах и каналах
* Временные пригласительные ссылки

И многие другие.

### Изменения с прошлой стабильной версии

* **Локальные папки**
  Помимо облачных папок, в Kotatogram теперь есть и локальные. Единственный недостаток: нет синхронизации. Зато там сняты лимиты настолько, насколько возможно, добавлены новые иконки и фильтры. А ещё есть отдельная страница о них: [Локальные папки](/ru/features/local-folders/).
* **Мультипересылка и пересылка без автора**
  Многострадальная мультипересылка и пересылка без автора наконец-то пришла в стабильную версию Kotatogram. Теперь вы можете пересылать сообщения в несколько чатов сразу, а также пересылать их без автора. Вы также можете использовать опции группировки сообщений, чтобы объединять их в альбомы, или наоборот, отправлять альбомы отдельными сообщениями. А, и да, если вы хотите вернуть старое поведение окна пересылки, когда при выборе чата происходил переход к нему, вы можете включить опцию «Открывать чат по клику».
* **Переработана информация об администраторах**
  Теперь в списке администраторов можно увидеть ранг и последний онлайн-статус, а в информации о нём – кто его назначил.
* **Упоминание пользователя из контекстного меню в списке участников**
  Это, к слову, работает и в списке администраторов: теперь призвать администратора навести порядок в группе должно стать ещё проще.
* **Улучшена клавиатурная навигация в календаре**
  Стрелки теперь используются для выбора дня, а для выбора месяца – Page Up и Page Down. А ещё с помощью End можно перейти к последней дате. И нет, это не равно переходу к последнему сообщению.
* **Закреплённые сообщения по умолчанию без звука**
  При ошибочном закреплённом сообщении без звука вы можете перезакрепить его со звуком без каких-либо дополнительных криков, чего не скажешь при ошибочном закреплённом сообщении со звуком.
* **Настройка «Сохранять выделение после пересылки»**
  Эта настройка позволит сохранить сообщения выделенными после отправки на случай, если вы захотите их потом удалить.
* **Опция для отключения всплывающей панели эмодзи**
  У меня не возникало с ней проблем, но люди жаловались на случайные нажатия, и поэтому просили эту фичу. Что же, теперь она есть. Если вам нужна всплывающая панель вместо боковой, вы можете нажать правой кнопкой мыши на кнопку с эмодзи.
* **Расширение выбора времени очистки загруженных медиафайлов**
  Помимо стандартных опций (от 1 недели до 1 года), теперь есть возможность поставить от 1 до 6 дней.
* **Кнопки управления группой/каналом в профиле**
  Для этой функции [@Deelite](https://t.me/Deelite) сделал концепт, и несмотря на то, что он реализован не в полной мере, должно стать поудобнее: по крайней мере теперь, не нужно каждый раз заходить в управление группой для доступа к журналу недавних действий. Бонус: в любой группе теперь можно просмотреть список администраторов, даже если вы не администратор.
* **Исправлен баг с переключением звук уведомлений в трее**
  Точнее, сам звук-то переключался, но почему-то надпись не обновлялась. Теперь обновляется.
* **Исправлены ссылки на разделы настроек**
  Такие ссылки, как tg://settings/kotato, снова работают.
* **Больше копирований по клику в профиле**
  Теперь по клику можно скопировать ID, юзернейм и номер телефона.
* **Удалять свои сообщения в личных чатах и обычных группах для всех по умолчанию**
  Мне кажется, там это более предпочтительный вариант.
* **Дополнительная информация о чатах в папке**
  Для пользователей в папке отображается статус контакта, а для чатов – тип чата, а при наличии и права администратора.
* **Более чистые уведомления**
  Теперь название аккаунта в уведомлении показывается только в том случае, если уведомление пришло от другого аккаунта.
* **Сочетание клавиш для перехода к дате в чате**
  По умолчанию используется Ctrl+H, но если вы хотите настроить на другое сочетание клавиш, команда называется `jump_to_date`.
* **В опросах с несколькими вариантами ответа теперь квадратные «галочки»**
  Так как квадратные галочки во многом уже ассоциируются со множественным выбором, то различать опросы с одним вариантом ответа от опросов с несколькими должно стать проще. Идея взята из Telegram X.
* **Улучшено отображение групп и каналов в окнах выбора чата**
  У групп в таких списках теперь отображается иконка владельца (цветная звезда)/администратора (серая звезда) рядом с именем, тип и количество участников/подписчиков. Такие окна можно увидеть при добавлении/удалении чатов в папке, настройках исключений приватности и т.д.
* **Улучшен поиск цветов темы в редакторе**
  Теперь поиск проверяет, есть ли такое сочетание не только в начале ключа, но ещё и в середине или в конце.
* **Возможность покрасить шапку чата отдельно от темы TDesktop**
  Крайне экспериментальная возможность делать темы для Kotatogram поверх тем для Telegram Desktop. Цвета, относящиеся к Kotatogram, начинаются с `ktg`, и всегда по умолчанию берут уже существующие в Telegram Desktop цвета, чтобы использовать пользовательские темы было не так болезненно.
* **Новая иконка удалённого пользователя в списке чатов**
  Эта иконка была взята из официального клиента Telegram под Android.
* **Скрыть папку «Все чаты» и кнопку папок «Изменить» теперь можно из их контекстного меню**
  Это дополнительный быстрый способ настройки. В будущем, возможно, такие способы появятся и для других настроек.
* **Кнопка удаления стикера из недавних по наведению на него**
  Интересный факт: эта кнопка есть и в самом Telegram Desktop, но почему-то она показана только для так называемых «локальных стикеров» (скорее всего, какие-нибудь не отправленные или вроде того). Но так как функция вполне могла бы быть полезна для любых стикеров, то я решил показывать её для всех.

### От [ilya-fedin](https://github.com/ilya-fedin)

Помимо сборок AppImage, которые вытеснили собой статичные бинари, в стабильной версии появилась сборка под macOS. Имейте в виду, что сборки очень экспериментальны, потому что ни у меня, ни у [ilya-fedin](https://github.com/ilya-fedin) нет устройств на macOS, чтобы проверить их работоспобность как следует, поэтому помощь тестеров в данном случае крайне важна. Также имейте в виду, что версия под macOS работает на версиях 10.15 и выше.

Также [ilya-fedin](https://github.com/ilya-fedin) внёс несколько новых функций и исправлений:

* **Возможность задать свои API ID и hash**
  Изначально была сделана возможность задать их через переменные среды (`KTGDESKTOP_API_ID=ВАШ_ID` и `KTGDESKTOP_API_HASH=ВАШ_HASH`), но я добавил возможность задать их параметрами запуска (`-api-id ВАШ_ID` и `-api-hash ВАШ_HASH`). Так как по умолчанию используются переменные среды, вы можете использовать параметр запуска `-no-env-api`, чтобы принудительно использовать вшитые или заданные вами из параметров запуска учётные данные.
* **Отключить счётчик на иконке в трее**
  Ранее эта опция была чисто для Linux, так как брала значение из переменной среды. Если вам по какой-либо причине не нравится счётчик сообщений в трее, то его можно отключить.
* **Системная иконка Telegram**
  Эта же опция так и осталась для Linux, но вместо переменной среды она переехала в настройки Kotatogram. Она позволяет брать из системной темы иконку Telegram, а не Kotatogram, что может быть важно, если в вашей теме иконок нет иконки для Kotatogram.
* **Смена иконки в трее без перезапуска**
  Имейте в виду, что менять иконку в трее без перезапуска можно только между встроенными. Если же вы используете свою иконку (через `icon.png`), то вам всё равно придётся перезапускать клиент.
* **Продвинутая информация об устройстве в сессии**
  Теперь информация берётся из встроенных методов Qt, благодаря чему версия отображается подробно. А ещё теперь можно увидеть имя компьютера в списке сессий.
* **Настройка «GTK-интеграция» для Linux**
  По умолчанию она выключена для лучшей совместимости с Qt, но лишает некоторых функций, а также могут возникнуть некоторые проблемы с буфером обмена.
* **Настройка «Диалог выбора файлов» для Linux**
  Эта настройка меняет окно выбора файлов на то, которое вам больше по душе или по удобству. Имейте в виду: опция «GTK» может быть отключена настройкой «GTK-интеграция», а другие настройки могут быть отключены при сборке, но в AppImage должны быть все доступны.
* **Настройка «Движок масштабирования Qt»**
  Эта настройка получает масштаб приложения таким же методом, как и другие Qt-приложения, через переменную среды `QT_SCALE_FACTOR`, но при этом отключается настраиваемое масштабирование внутри самого приложения.
* Исправлена прокрутка на масштабах, отличных от 100%.
* Исправления для иконки в трее на Linux, связанные с XEmbed и SNI.
* Системный шрифт теперь используется по умолчанию на Linux.
* Исправлен жирный шрифт при использовании системного.

### Из [64Gram](https://t.me/tg_x64) (бывший TDesktop-x64)

* **Разделённое разрешение «Отправка стикеров и GIF»**
  Эта настройка на самом деле содержит в себе четыре настройки: отправка стикеров, отправка GIF, отправка игр и отправка сообщений через ботов.
* **Не делиться номером телефона по умолчанию**
  Если вы добавляете в контакты при скрытии своего номера от всех, у вас будет галочка «Поделиться номером телефона», но в официальных клиентах она включена по умолчанию, из-за чего можно случайно раскрыть свой номер.
* **Раздел GIF в общих медиа**
  Наряду с фото, видео, ссылками и т.д., теперь в общих медиа есть и раздел GIF.

К слову, о поддержке 64-бит. Так как Telegram Desktop уже собирает 64-битные билды под Windows параллельно с 32-битными, они теперь есть и у Kotatogram. Более того, для 64-битных билдов на всех системах был увеличен лимит аккаунтов до 100. В 32-битном билде под Windows он всё ещё 10 из-за возможных вылетов при превышении ограничения по памяти (примерно 1.5 ГБ).

### От других пользователей

* Возможность отключить расширение сообщений с моноширинным текстом, которое была сделано в Telegram Desktop. [Добавлена пользователем CrisMystik](https://github.com/kotatogram/kotatogram-desktop/pull/58).
* Конвертирование ссылок вида `tg://user?id=id_юзера` в упоминание при добавлении через окно «Добавить ссылку». [Добавлена пользователем the-blank-x](https://github.com/kotatogram/kotatogram-desktop/pull/144).

### Реализовано в Telegram Desktop

* **Отключение мигания иконки на панели задач**
  Теперь эта опция есть в Telegram Desktop и работает для всех систем, поэтому её дубликат убран. Теперь её можно найти в Настройки > Уведомления, прямо под галочкой Звук.
* **Системная рамка окна**
  Её теперь можно найти в Настройки > Продвинутые настройки > Интеграция в систему, под галочкой «Показывать иконку на панели задач».
* **Подсветка фотографии в альбоме при переходе к сообщению**
  В Telegram Desktop она реализована немного иначе: вместо изменения прозрачности всех фотографий, кроме нужной, подсвечивается только нужная фотография цветом подсветки сообщения. Кстати, это работает и для альбомов файлов. Само собой, дублирующая функция была убрана.

### Изменения с прошлой бета-версии

* **Выбор времени отложенного сообщения был возвращён к поведению по умолчанию**
  Скорее всего, поведение из 1.3.9 потом вернётся как опция.
* **Ctrl+J для перехода к дате в чате было заменено на Ctrl+H**
  В Telegram Desktop по умолчанию по Ctrl+J открывались «Контакты», поэтому сочетание клавиш немного сместилось влево.
* **Опция «Отметить все сообщения как прочитанные» теперь более явная**
  В Telegram Desktop её можно найти в контекстном меню папок и контекстном меню архива, а также в контекстном меню аккаунта... если вы зажали Shift+Alt перед нажатием ПКМ. Теперь эта опция была перемещена в контекстное меню, которому не требуется зажатие Shift+Alt. Бонус: теперь вы можете выйти из текущего аккаунта прямо из списка аккаунтов.
* **Исправлена настройка «Лимит недавних стикеров»**
  Из-за ошибки проверки в JSON-конфиге можно было выставить неправильное значение.
* **Контурная иконка Kotatogram в настройках**
  Так как во всём Telegram используются контурные иконки, я сделал иконку у пункта «Настройки Kotatogram» контурной, чтобы она сочеталась с остальными. Кстати, старая иконка у настроек тоже контурная.
* **Исправлено скругление кнопки выбора аватарки**
  Баг можно было увидеть в окне «Создать группу/канал». Кнопка всегда показывалась круглой вне зависимости от настроек скругления. Теперь всё отображается корректно.
* **Исправлен показ времени служебных сообщений в списке чатов**
  Так как в списке чатов уже есть время последнего сообщения, дублировать его там незачем.
* **Возвращено сообщение о переводе группы в супергруппу**
  Так как попытка слияния групп и супергрупп в Telegram вызывает путаницу, сообщение о переводе было возвращено.
* **Время служебного сообщения теперь не отображается без необходимости**
  В основном это сделано потому, что время дублируется. К примеру, в недавних действиях время у «Пользователь изменил(а) сообщение:» указывалось прямо в следующем сообщении.
* **Исправлено отображение эмодзи заголовках разделов**
  Баг можно было увидеть в заголовке отложенных сообщений, если у пользователя есть эмодзи в имени.
* **Исправлено добавление чатов в локальную папку**
  Ранее после перезапуска чаты в локальной папке, добавленные или исключённые явно, отображались как пустые.
* **Callback-данные кнопки бота теперь можно посмотреть в подсказке при наведении**
  Это дополнение к уже существующей возможности скопировать callback-данные.
* **Время сервисного сообщения теперь корректно копируется**
  Ранее его можно было выделить, но в буфер обмена оно не попадало.
* **Исправлены повторяющиеся уведомления со списком изменений**
  Баг проявлялся, если сразу после обновления долго не выключать приложение.
* **Исправлено открытие профиля заблокированных пользователей в группе**
  Ранее открытие профиля происходило под окном заблокированных пользователей, а при повторном нажатии происходил вылет.
* **Подтверждение перед звонком теперь по умолчанию**
  Учитывая, что случайное нажатие может раздражать больше, стоит включить эту настройку по умолчанию.
* **ID профиля теперь показывается по умолчанию**
  Так как о том, как включить, спрашивают часто, функция включена по умолчанию в режиме «Bot API».
* **Восстановлен краш-репортер**
  Имейте в виду: так как дампы мне всё ещё некуда заливать, при вылете придётся их отправлять вручную из папки `папка_профиля/tdata/dumps`.
* **«Пригласительные ссылки» теперь отображаются в профиле**
  Равно как и список администраторов/заблокированных и недавние действия, этот пункт также продублирован в профиль.
* **Исправлено повторное открытие «Недавних действий»**
  Ранее повторное окрытие ломало фильтр.

## Что дальше?

Теперь, когда обновление вышло, хотелось бы поговорить о том, что ждёт Kotatogram в будущем.

Несмотря на то, что ещё много чего предстоит реализовать, нельзя забывать и о том, что уже есть. Поэтому, помимо новых функций, Kotatogram могут ждать изменения, связанные с уже существующей функциональностью.

### Изменение меню настроек

В меню настройки сейчас очень много пунктов, и это плохо тем, что в таком меню можно запросто потеряться (особенно со временем, потому что количество функций растёт).

Поэтому я планирую со временем улучшить меню, чтобы не теряться в настройках лишний раз.

### Тестовые ветки

Некоторое время назад я начал выкладывать тестовые версии в чат форка. Почему я не анонсировал это в канале? Потому что они, на мой взгляд, были слишком нестабильны, нуждались в тестах, и относительно быстрой обратной связи.

Но и у них были проблемы: тестовые версии собирались вначале без автоапдейтера, затем с автоапдейтером, но так как полноценной тестовой ветки нет, этот апдейтер может обновить только до стабильной или беты. Плюс, у них не было указано отдельных версий, что создавало определённые проблемы при определении того, в какой версии был пойман баг.

Поэтому я планирую сделать тестовые ветки, которые будут работать отдельно от стабильной и беты. Почему именно ветки, а не ветка? Потому что на них я могу обкатывать различные новые функции до выхода в релиз и в принципе экспериментировать. При этом откатывать функции там будет менее болезненно, чем если я буду откатывать функции беты. Особенно если они крупные и почти готовые. Я не особо хочу следующий релиз выпустить через год.

### Улучшение информации о программе

Сейчас в основном для сведений о программе используются стандартные окна. Есть повод их переработать по нескольким причинам.

1. **Улучшенные списки изменений**
  Сейчас для списка изменений используется заглушка, ведущая на канал. В будущем я хочу, чтобы списки изменений говорили хотя бы о крупных изменениях в текущих версиях (или чтобы полный список был в отдельном окне). Или чтобы можно было просмотреть все предыдущие списки изменений.
2. **Улучшенное указание авторства**
  Помимо того, что Kotatogram Desktop был основан на Telegram Desktop, и, соответственно, наследует функции, сделанные всеми, кто внёс в него вклад, немало людей вложились и в сам Kotatogram Desktop, и это вполне нормально, что люди хотят быть указаны как соавторы. 
3. **Улучшенная справка**
  Люди часто задают вопросы по определённым функциям, поэтому я бы хотел хотя бы частично облегчить им жизнь, встроив возможность просмотреть справку по конкретным функциям. Ну или хотя бы перенаправлять на чат, где они могут об этом спросить.

---

В конце хотелось бы поблагодарить всех, кто предлагает идеи для функций, реализовывает их, переводит (теперь для этого есть отдельная страница на Crowdin), сообщает о багах и помогает в их отладки, да и просто использует Kotatogram. Планов, как всегда, много, и надеюсь, что потихоньку они все будут реализованы. А пока что обновляйтесь и пользуйтесь новыми функциями Kotatogram.
